sex_by_age <- get_acs(
geography = "tract",
table = "B01001",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE, #change to TRUE for maps
cache_table = TRUE
)
##Age##
#see sex_by_age
##Race and Ethnicity##
#pull race  from ACS
race <- get_acs(
geography = "tract",
table = "B02001",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE #change to TRUE for maps
)
#pull ethnicity  from ACS
ethnicity <-
get_acs(
geography = "tract",
table = "B03002",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE #change to TRUE for maps
)
##Median Income/Poverty##
#pull income from ACS
median_income <-
get_acs(
geography = "tract",
table = "B19013",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE #change to TRUE for maps
)
#pull poverty level from ACS
poverty_level <-
get_acs(
geography = "tract",
table = "B17001",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE, #change to TRUE for maps
)
##Employment Status##
#pull employment status from acs
employment_status <-
get_acs(
geography = "tract",
table = "B23025",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE, #change to TRUE for maps
)
##Gender##
#see sex_by_age
##Family structure##
#pull family structure
family_structure <-
get_acs(
geography = "tract",
table = "B11003",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE, #change to TRUE for maps
)
################## Language Access and Cultural Considerations #######################
##Limited English##
#pull from acs
language <-
get_acs(
geography = "tract",
table = "B16004",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE, ##change to TRUE for map of other languages spoken
)
##Other languages spoken in the area##
#see language
##Country of origin##
#pull from acs
country_origin <-
get_acs(
geography = "tract",
table = "B05006",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE,
)
######################## Other Accessibility Considerations ########################
## Disability Status ##
#pulling disability status data
disability <-
get_acs(
geography = "tract",
variables = c(
total_pop = "B18101_001",
v1="B18101_004",
v2="B18101_007",
v3="B18101_010",
v4="B18101_013",
v5="B18101_016",
v6="B18101_019",
v7="B18101_023",
v8="B18101_026",
v9="B18101_029",
v10="B18101_032",
v11="B18101_035",
v12="B18101_038"
),
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE
) %>%
select(GEOID, variable, estimate) %>%
pivot_wider(names_from = variable, values_from = estimate)%>% #pivoting so each tract is one row and each variable is one column
mutate(
total_disability =v1+v2+v3+v4+v5+v6+v7+v8+v9+v10+v11+v12, #summing diability by sex by age to get total population with disability by tract
share_disability = total_disability/total_pop)%>% #generating share of tract population with disability
select(GEOID,total_pop,total_disability,share_disability) #reducing df to necessary variables
#binding with pico tracts to limit our data to the study area
pico_disability <- disability %>%
filter(GEOID %in% pico_tracts$GEOID)
View(disability)
#add geometry from census tracts to create a map
st_geometry(pico_disability) <- st_geometry(pico_tracts[match(pico_disability$GEOID, pico_tracts$GEOID), ])
class(pico_disability)
View(pico_disability)
###pull hearing difficulty status
hearing_diff <-
get_acs(
geography = "tract",
variables = c(
total_pop = "B18102_001",
v1="B18102_004",
v2="B18102_007",
v3="B18102_010",
v4="B18102_013",
v5="B18102_016",
v6="B18102_019",
v7="B18102_023",
v8="B18102_026",
v9="B18102_029",
v10="B18102_032",
v11="B18102_035",
v12="B18102_038"
),
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE
) %>%
select(GEOID, variable, estimate) %>%
pivot_wider(names_from = variable, values_from = estimate)%>% #pivoting
mutate(
total_hearing_diff =v1+v2+v3+v4+v5+v6+v7+v8+v9+v10+v11+v12, #summing hearing diff by sex by age to get total population with hearing diff
share_hearing_diff = total_hearing_diff/total_pop)%>% #generating share of tract population with hearing diff
select(GEOID,total_pop,total_hearing_diff,share_hearing_diff)%>% #reducing df to necessary variables
filter(GEOID %in% pico_tracts$GEOID) #limiting to pico tracts
#add geometry for map
st_geometry(hearing_diff) <- st_geometry(pico_tracts[match(hearing_diff$GEOID, pico_tracts$GEOID), ])
class(hearing_diff)
View(hearing_diff)
#### pull vision difficulty status data ####
vision_diff <-
get_acs(
geography = "tract",
variables = c(
total_pop = "B18103_001",
v1="B18103_004",
v2="B18103_007",
v3="B18103_010",
v4="B18103_013",
v5="B18103_016",
v6="B18103_019",
v7="B18103_023",
v8="B18103_026",
v9="B18103_029",
v10="B18103_032",
v11="B18103_035",
v12="B18103_038"
),
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE
) %>%
select(GEOID, variable, estimate) %>%
pivot_wider(names_from = variable, values_from = estimate)%>% #pivoting
mutate(
total_vision_diff =v1+v2+v3+v4+v5+v6+v7+v8+v9+v10+v11+v12, #summing hearing diff by sex by age to get total population with vision diff
share_vision_diff = total_vision_diff/total_pop)%>% #generating share of tract population with vision diff
select(GEOID,total_pop,total_vision_diff,share_vision_diff)%>% #reducing df to necessary variables
filter(GEOID %in% pico_tracts$GEOID) #limiting to pico tracts
#add geometry for map
st_geometry(vision_diff) <- st_geometry(pico_tracts[match(vision_diff$GEOID, pico_tracts$GEOID), ])
class(vision_diff)
View(vision_diff)
summary(hearing_diff$total_hearing_diff)
summaru(vision_diff$total_vision_diff)
summary(vision_diff$total_vision_diff)
#### pulling ambulatory difficulty data ####
ambulatory_diff <-
get_acs(
geography = "tract",
table = "B18105",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE,
)%>%
select(GEOID, variable, estimate) %>%
pivot_wider(names_from = variable, values_from = estimate)%>% #pivoting
mutate(
total =B18105_001,
total_ambulatory_diff = (B18105_004 + B18105_007 + B18105_010 + B18105_013 + B18105_016 +
B18105_020 + B18105_023 + B18105_026 + B18105_029 + B18105_032),
share_ambulatory_diff = total_ambulatory_diff/total
)%>%
select(GEOID,total, total_ambulatory_diff, share_ambulatory_diff)%>% #reducing df to necessary variables
filter(GEOID %in% pico_tracts$GEOID) #limiting to pico tracts
#add geometry for map
st_geometry(ambulatory_diff) <- st_geometry(pico_tracts[match(ambulatory_diff$GEOID, pico_tracts$GEOID), ])
class(ambulatory_diff)
View(ambulatory_diff)
summary(ambulatory_diff$total_ambulatory_diff)
#### Internet/Computer access ####
#pull internet data
internet_subs <-
get_acs(
geography = "tract",
variables = c(
total_pop = "B28002_001",
no_int_access = "B28002_013"),
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE, #change back to TRUE to make a map
)%>%
select(GEOID, variable, estimate) %>%
pivot_wider(names_from = variable, values_from = estimate)%>% #pivoting
mutate(
share_no_int = no_int_access/total_pop)%>% #generating share of tract population without internet access
select(GEOID,total_pop,no_int_access,share_no_int)%>% #reducing df to necessary variables
filter(GEOID %in% pico_tracts$GEOID) #limiting to pico tracts
#adding geometry for map
st_geometry(internet_subs) <- st_geometry(pico_tracts[match(internet_subs$GEOID, pico_tracts$GEOID), ])
class(internet_subs)
View(internet_subs)
### pull tech access data ###
tech_access <-
get_acs(
geography = "tract",
variables = c(
total_pop = "B28001_001",
no_computer = "B28001_011"
),
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE,
)%>%
select(GEOID, variable, estimate) %>%
pivot_wider(names_from = variable, values_from = estimate)%>% #pivoting
mutate(
share_no_computer = no_computer/total_pop)%>% #generating share of tract population with different types of computer access
select(GEOID,total_pop,no_computer,share_no_computer)%>% #reducing df to necessary variables
filter(GEOID %in% pico_tracts$GEOID) #limiting to pico tracts
#add geometry for map
st_geometry(tech_access) <- st_geometry(pico_tracts[match(tech_access$GEOID, pico_tracts$GEOID), ])
class(tech_access)
View(tech_access)
### Homeowners/Renters ###
#pull housing tenure data
tenure <-
get_acs(
geography = "tract",
variables = c(
total_occupied = "B25003_001",
owner_occupied = "B25003_002",
renter_occupied = "B25003_003"
),
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE,
)%>%
select(GEOID, variable, estimate) %>%
pivot_wider(names_from = variable, values_from = estimate)%>% #pivoting
mutate(
share_owner_occupied = owner_occupied/total_occupied,
share_renter_occupied = renter_occupied/total_occupied)%>% #generating shares of HU that are owner/renter occupied
select(GEOID,total_occupied,owner_occupied,share_owner_occupied, renter_occupied, share_renter_occupied)%>% #reducing df to necessary variables
filter(GEOID %in% pico_tracts$GEOID) #limiting to pico tracts
#adding geometry for map
st_geometry(tenure) <- st_geometry(pico_tracts[match(tenure$GEOID, pico_tracts$GEOID), ])
class(tenure)
View(tenure)
summary(tenure$share_renter_occupied)
##Housing Cost Burden##
#pull cost burden data
### for renters
renter_burden <-
get_acs(
geography = "tract",
variables = c(
total = "B25070_001",
spend_30_35 = "B25070_007",
spend_35_40 = "B25070_008",
spend_40_50="B25070_009",
spend_50_more = "B25070_010",
median_share_inc_housing = "B25071_001"
),
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE,
)%>%
select(GEOID, variable, estimate) %>%
pivot_wider(names_from = variable, values_from = estimate)%>% #pivoting
mutate(
total_over_30 = (spend_30_35 + spend_35_40+spend_40_50 + spend_50_more),
share_over_30 = (spend_30_35 + spend_35_40+spend_40_50 + spend_50_more)/total,
share_over_50 = spend_50_more/total)%>% #generating shares of HH that are rent burdened and extremely rent burdened
select(GEOID,total,spend_50_more,total_over_30,share_over_30,share_over_50,median_share_inc_housing)%>% #reducing df to necessary variables
filter(GEOID %in% pico_tracts$GEOID) #limiting to pico tracts
#adding geometry for map
st_geometry(renter_burden) <- st_geometry(pico_tracts[match(renter_burden$GEOID, pico_tracts$GEOID), ])
class(renter_burden)
View(renter_burden)
##Car free and one car##
#pull car data
vehicles <-
get_acs(
geography = "tract",
variables = c(
total = "B25044_001",
no_car_o = "B25044_003",
one_car_o = "B25044_004",
no_car_r = "B25044_010",
one_car_r = "B25044_011"
),
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE,
)%>%
select(GEOID, variable, estimate) %>%
pivot_wider(names_from = variable, values_from = estimate) %>% # pivoting
mutate(
no_car = (no_car_o + no_car_r),
one_car = (one_car_o + one_car_r),
share_no_car = (no_car/total),
share_one_car = (one_car/total),
multiple_car = (total - no_car - one_car)
)%>%
select(GEOID, total, no_car, one_car, share_no_car, share_one_car, multiple_car) %>% # reducing df to necessary variables
filter(GEOID %in% pico_tracts$GEOID) # limiting to pico tracts
#adding geometry for map
st_geometry(vehicles) <- st_geometry(pico_tracts[match(vehicles$GEOID, pico_tracts$GEOID), ])
class(vehicles)
View(vehicles)
######## H+T Index metrics #######
#pull H+T data
ht_index <- read.csv(file.path(file_path, "Data/htaindex2022_data_tracts_06.csv"))%>%
rename(GEOID = tract)%>%
mutate(GEOID = gsub('"', '', GEOID))%>%
mutate(GEOID = str_pad(GEOID, width = 11, pad = "0"))%>% #need to add a leading zero to match GEOID structure
filter(GEOID %in% pico_tracts$GEOID) # limiting to pico tracts
#add geometry for map
st_geometry(ht_index) <- st_geometry(pico_tracts[match(ht_index$GEOID, pico_tracts$GEOID), ])
class(ht_index)
View(ht_index)
library(sf)
library(dplyr)
# Replace with the actual path to your unzipped shapefile directory
shapefile_path <- "C:/Users/tmaginn/Desktop/tmaginn/Projects/IZ/Rent/tl_2022_us_zcta520.shp"
zcta_sf <- st_read(shapefile_path)
# Replace with the actual path to your unzipped shapefile directory
shapefile_path <- "C:\Users\tmaginn\Desktop\tmaginn\Projects\IZ\Rent\tl_2022_us_zcta520.zip"
# Replace with the actual path to your unzipped shapefile directory
shapefile_path <- "C:/Users/tmaginn/Desktop/tmaginn/Projects/IZ/Rent/tl_2022_us_zcta520.zip"
zcta_sf <- st_read(shapefile_path)
shapefile_path <- "C:/Users/tmaginn/Desktop/tmaginn/Projects/IZ/Rent/tl_2022_us_zcta520.shp"
zcta_sf <- st_read(shapefile_path)
# Replace with the actual path to your unzipped shapefile directory
shapefile_path <- "C:/Users/tmaginn/Desktop/tmaginn/Projects/IZ/Rent/tl_2022_us_zcta520/tl_2022_us_zcta520.shp"
zcta_sf <- st_read(shapefile_path)
csv_data <- read.csv("C:/Users/tmaginn/Desktop/tmaginn/Projects/IZ/Rent/zillow_zipcode_rental_data.csv", stringsAsFactors = FALSE)
View(csv_data)
csv_data <- read.csv("C:/Users/tmaginn/Desktop/tmaginn/Projects/IZ/Rent/zillow_zipcode_rental_data.csv", stringsAsFactors = FALSE)%>%
filter(StateName == "DC")
View(csv_data)
csv_data <- read.csv("C:/Users/tmaginn/Desktop/tmaginn/Projects/IZ/Rent/zillow_zipcode_rental_data.csv", stringsAsFactors = FALSE)%>%
filter(StateName == "DC")%>%
select(-RegionID, -SizeRank, -RegionType, -StateName, -City, -Metro, -CountyName)
View(csv_data)
csv_data$zipcode <- sprintf("%05s", csv_data$zip)
zcta_sf$ZCTA5CE20 <- as.character(zcta_sf$ZCTA5CE20
merged_sf <- zcta_sf %>%
View(zcta_sf)
zcta_dc <- zcta_sf %>%
filter(ZCTA5CE20 %in% csv_data$zipcode)
# Perform the join
merged_sf <- zcta_dc %>%
left_join(csv_data, by = c("ZCTA5CE20" = "zipcode"))
View(merged_sf)
merged_sf <- zcta_dc %>%
left_join(csv_data, by = c("ZCTA5CE20" = "zipcode"))%>%
select(-CLASSFP20, GEOID20, -MTFCC20, -FUNCSTAT20, -ALAND20, -AWATER20, -INTPTLAT20, -INTPTLON20)
#save
st_write(merged_sf, "zillow_zipcode_rents.shp", driver = "ESRI Shapefile")
list(rm-list())
rm(ls-list())
rm(list = ls())
### working with zillow rernts
###libraries###
library(tidyverse)
library(ggplot2)
library(urbnmapr)
library(sf)
library(tigris)
library(ggrepel)
library(urbnthemes)
library(tigris)
#Reading in TIGER 2022 shapefile
shapefile_path <- "C:/Users/tmaginn/Desktop/tmaginn/Projects/IZ/Rent/tl_2022_us_zcta520/tl_2022_us_zcta520.shp"
zcta_sf <- st_read(shapefile_path)
#reading in zillow rents
zillow_rents <- read.csv("C:/Users/tmaginn/Desktop/tmaginn/Projects/IZ/Rent/zillow_zipcode_rental_data.csv", stringsAsFactors = FALSE)%>%
filter(StateName == "DC")%>%
select(-RegionID, -SizeRank, -RegionType, -StateName, -City, -Metro, -CountyName)
zillow_rents$zipcode <- sprintf("%05s", zillow_rents$zip)
zcta_sf$ZCTA5CE20 <- as.character(zcta_sf$ZCTA5CE20)
# Filter shapefile to only include DC zip codes
zcta_dc <- zcta_sf %>%
filter(ZCTA5CE20 %in% czillow_rents$zipcode)
### working with zillow rernts
###libraries###
library(tidyverse)
library(ggplot2)
library(urbnmapr)
library(sf)
library(tigris)
library(ggrepel)
library(urbnthemes)
library(tigris)
#Reading in TIGER 2022 shapefile
shapefile_path <- "C:/Users/tmaginn/Desktop/tmaginn/Projects/IZ/Rent/tl_2022_us_zcta520/tl_2022_us_zcta520.shp"
zcta_sf <- st_read(shapefile_path)
#reading in zillow rents
zillow_rents <- read.csv("C:/Users/tmaginn/Desktop/tmaginn/Projects/IZ/Rent/zillow_zipcode_rental_data.csv", stringsAsFactors = FALSE)%>%
filter(StateName == "DC")%>%
select(-RegionID, -SizeRank, -RegionType, -StateName, -City, -Metro, -CountyName)
zillow_rents$zipcode <- sprintf("%05s", zillow_rents$zip)
zcta_sf$ZCTA5CE20 <- as.character(zcta_sf$ZCTA5CE20)
# Filter shapefile to only include DC zip codes
zcta_dc <- zcta_sf %>%
filter(ZCTA5CE20 %in% zillow_rents$zipcode)
# Execute join so that zip codes in the zillow rental data have a geometry
zillow_rents_sf <- zcta_dc %>%
left_join(zillow_rents, by = c("ZCTA5CE20" = "zipcode"))%>%
select(-CLASSFP20, GEOID20, -MTFCC20, -FUNCSTAT20, -ALAND20, -AWATER20, -INTPTLAT20, -INTPTLON20)
#load in IZ database
iz_database <- read.csv("C:/Users/tmaginn/Desktop/tmaginn/Projects/IZ/Rent/iz_database.csv")
View(iz_database)
#setting iz database as a shapefile
iz_database_sf <- st_as_sf(iz_database, coords = c("longitude", "latitude"), crs = 4326)  # WGS 84
#making sure the crs is the same for both datasets
zillow_rents_sf <- st_transform(zillow_rents_sf, crs = 4326)
#spatial merge - we are seeing which zip code each building falls in and then merging the corresponding zip code and rent info to the building
iz_database_zillow <- st_join(iz_database_sf, zillow_rents_sf, join = st_within)
View(iz_database_zillow)
#saving
write.csv(st_drop_geometry(iz_database_zillow), "iz_database_zillow_data.csv", row.names = FALSE)
iz_database_zillow <- st_join(iz_database_sf, zillow_rents_sf, join = st_within)%>%
rename(zip_code = ZCTA5CE20)
View(iz_database_zillow)
#saving
write.csv(st_drop_geometry(iz_database_zillow), "C:/Users/tmaginn/Desktop/tmaginn/Projects/IZ/Rent/iz_database_zillow_data.csv", row.names = FALSE)
View(iz_database_zillow)
