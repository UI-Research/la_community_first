county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE,
)
write.csv(renter_burden, file.path(file_path, "Fileshare", "renter_burden.csv"), row.names = FALSE)
#for owners
owner_burden <-
get_acs(
geography = "tract",
table = "B25091",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE,
)
write.csv(owner_burden, file.path(file_path, "Fileshare", "owner_burden.csv"), row.names = FALSE)
write.csv(vehicles, file.path(file_path, "Fileshare", "vehicles.csv"), row.names = FALSE)
##Car free and one car##
#pull car data
vehicles <-
get_acs(
geography = "tract",
table = "B25044",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE,
)
write.csv(vehicles, file.path(file_path, "Fileshare", "vehicles.csv"), row.names = FALSE)
write.csv(transportation_means, file.path(file_path, "Fileshare", "transportation_means.csv"), row.names = FALSE)
##Method for commuting to work##
#pull means of transportation data
transportation_means <-
get_acs(
geography = "tract",
table = "B08301",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE,
)
write.csv(transportation_means, file.path(file_path, "Fileshare", "transportation_means.csv"), row.names = FALSE)
#pull travel time data
travel_time <-
get_acs(
geography = "tract",
table = "B08303",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE,
)
write.csv(travel_time, file.path(file_path, "Fileshare", "travel_time.csv"), row.names = FALSE)
##Race and Ethnicity##
#pull race  from ACS
race <- get_acs(
geography = "tract",
table = "B02001",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE
)
write.csv(race, file.path(file_path, "Fileshare", "race.csv"), row.names = FALSE)
write.csv(hrs_worked, file.path(file_path, "Fileshare", "internet_subs.csv"), row.names = FALSE)
#create bins of different age groups, based on census data dictionary (v23)
age_bins <- list(
age_0_17  = c("B01001_003", "B01001_004", "B01001_005", "B01001_006",
"B01001_027", "B01001_028", "B01001_029", "B01001_030"),
age_18_29 = c("B01001_007", "B01001_008", "B01001_009", "B01001_010", "B01001_011",
"B01001_031", "B01001_032", "B01001_033","B01001_034", "B01001_035"),
age_30_44 = c("B01001_012","B01001_013", "B01001_014",
"B01001_036", "B01001_037", "B01001_038"),
age_45_59 = c("B01001_015", "B01001_016", "B01001_017",
"B01001_039", "B01001_040", "B01001_041"),
age_60_up = c("B01001_018", "B01001_019","B01001_020", "B01001_021", "B01001_022", "B01001_023", "B01001_024", "B01001_025",
"B01001_041", "B01001_042", "B01001_043", "B01001_044", "B01001_045", "B01001_046", "B01001_047", "B01001_048", "B01001_049")
)
#summarise total by age, for each tract
age_wide_pico <- sex_by_age %>%
filter(variable %in% unlist(age_bins), GEOID %in% pico_tracts$GEOID)%>%
group_by(GEOID)%>%
mutate(age_group = case_when(
variable %in% age_bins$age_0_17 ~ "age_0_17",
variable %in% age_bins$age_18_29 ~ "age_18_29",
variable %in% age_bins$age_30_44 ~ "age_30_44",
variable %in% age_bins$age_45_59 ~ "age_45_59",
variable %in% age_bins$age_60_up ~ "age_60_up",
)) %>%
group_by(GEOID, age_group)%>%
summarise(population = sum(estimate, na.rm = TRUE), .groups = "drop")%>%
pivot_wider(names_from = age_group, values_from = population)
#calculate the total age
age_totals <- age_wide_pico %>%
summarise(across(starts_with("age_"), ~sum(.x, na.rm = TRUE))) %>%
pivot_longer(
cols = everything(),
names_to = "age_group",
values_to = "population"
)
age_totals
#create a bar chart
pop_by_age_group <- ggplot(age_totals, aes(x = age_group, y = population, fill = age_group)) +
geom_col() +
labs(
x = "Age Group",
y = "Population"
) +
scale_x_discrete(
labels = c(
"age_0_17" = "0-17",
"age_18_29" = "18-29",
"age_30_44" = "30-44",
"age_45_59" = "45-59",
"age_60_up" = "60+"
))+
scale_y_continuous(labels = scales::comma) +
theme(legend.position = "none")+
theme(
axis.title.x = element_text(size = 14),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 16),
axis.text.y = element_text(size = 16))
pop_by_age_group
ggsave(file.path(file_path, "Pico/Outputs/age_chart_pico.png"), width = 14, height = 6, dpi = 300)
#create map of population
population_map_pico <- ggplot(pop_wide_pico) +
geom_sf(aes(fill = population), show.legend = TRUE) +
#add the buffer overlay
geom_sf(data = pico_buffer_tracts, color = "yellow", alpha = 0.2, lwd = 1) +
#add the street overlay
geom_sf(data = major_streets_clipped, color = "gray20", size = 0.3) +
scale_fill_gradientn(
colors = palette_urbn_cyan[c(2, 4, 6, 7)],  # Selecting a subset of colors
name = "Population by Census Tract",
labels = scales::comma
) +
theme_urbn_map()+
theme(
legend.title = element_text(size = 16),
legend.text = element_text(size = 16),
legend.key.height = unit(1.2, "cm"),
legend.key.width = unit(0.6, "cm")
)
#restructure so that each row is a census tract
##ADD geometry##
pop_wide_pico <- sex_by_age %>%
select(GEOID, variable, estimate, moe) %>%
filter(variable == "B01001_001", GEOID %in% pico_tracts$GEOID)%>%
pivot_wider(names_from = variable, values_from = estimate)%>%
rename(population = B01001_001)
#add census tracts
pop_wide_pico <- left_join(pico_tracts, pop_wide_pico, by = "GEOID")
#confirm that this is a shapefile
sf::st_geometry(age_wide_pico)
#data - get the total population
totalpop <- sum(age_wide_pico$population)
##Population##
#pull population table from ACS
sex_by_age <- get_acs(
geography = "tract",
table = "B01001",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE
)
#restructure so that each row is a census tract
##ADD geometry##
pop_wide_pico <- sex_by_age %>%
select(GEOID, variable, estimate, moe) %>%
filter(variable == "B01001_001", GEOID %in% pico_tracts$GEOID)%>%
pivot_wider(names_from = variable, values_from = estimate)%>%
rename(population = B01001_001)
#add census tracts
pop_wide_pico <- left_join(pico_tracts, pop_wide_pico, by = "GEOID")
#confirm that this is a shapefile
sf::st_geometry(age_wide_pico)
#data - get the total population
totalpop <- sum(age_wide_pico$population)
#create a histogram
population_histogram_pico <- ggplot(pop_wide_pico, aes(x = population)) +
geom_histogram(binwidth = 500) +
labs(
title = NULL,
x = "Population",
y = "Census Tracts"
)
population_histogram_pico
ggsave(file.path(file_path, "Pico/Outputs/population_histogram_pico.png"), width = 8, height = 6, dpi = 300)
#create map of population
population_map_pico <- ggplot(pop_wide_pico) +
geom_sf(aes(fill = population), show.legend = TRUE) +
#add the buffer overlay
geom_sf(data = pico_buffer_tracts, color = "yellow", alpha = 0.2, lwd = 1) +
#add the street overlay
geom_sf(data = major_streets_clipped, color = "gray20", size = 0.3) +
scale_fill_gradientn(
colors = palette_urbn_cyan[c(2, 4, 6, 7)],  # Selecting a subset of colors
name = "Population by Census Tract",
labels = scales::comma
) +
theme_urbn_map()+
theme(
legend.title = element_text(size = 16),
legend.text = element_text(size = 16),
legend.key.height = unit(1.2, "cm"),
legend.key.width = unit(0.6, "cm")
)
population_map_pico
ggsave(file.path(file_path, "Pico/Outputs/population_map_pico.png"), width = 14, height = 6, dpi = 300)
#create a bar chart
pop_by_age_group <- ggplot(age_totals, aes(x = age_group, y = population, fill = age_group)) +
geom_col() +
labs(
x = "Age Group",
y = "Population"
) +
scale_x_discrete(
labels = c(
"age_0_17" = "0-17",
"age_18_29" = "18-29",
"age_30_44" = "30-44",
"age_45_59" = "45-59",
"age_60_up" = "60+"
))+
scale_y_continuous(labels = scales::comma) +
theme(legend.position = "none")+
theme(
axis.title.x = element_text(size = 16),
axis.title.y = element_text(size = 16),
axis.text.x = element_text(size = 16),
axis.text.y = element_text(size = 16))
ggsave(file.path(file_path, "Pico/Outputs/age_chart_pico.png"), width = 14, height = 6, dpi = 300)
View(race)
race_wide_pico <- race %>%
filter(GEOID %in% pico_tracts$GEOID,
variable %in% c("B02001_002", "B02001_003", "B02001_004", "B02001_005", "B02001_009")) %>%
select(GEOID, variable, estimate) %>%
pivot_wider(
names_from = variable,
values_from = estimate,
names_prefix = "race_"
) %>%
rename(
white = race_B02001_002,
black = race_B02001_003,
native_am = race_B02001_004,
asian = race_B02001_005,
other = race_B02001_009
)
View(race_wide_pico)
race_wide_pico <- race %>%
filter(GEOID %in% pico_tracts$GEOID,
variable %in% c("B02001_001",  # Total pop
"B02001_002",  # White
"B02001_003",  # Black
"B02001_004",  # Native American
"B02001_005",  # Asian
"B02001_009"   # Other
)) %>%
select(GEOID, variable, estimate) %>%
pivot_wider(
names_from = variable,
values_from = estimate,
names_prefix = "race_"
) %>%
rename(
total = race_B02001_001,
white = race_B02001_002,
black = race_B02001_003,
native_am = race_B02001_004,
asian = race_B02001_005,
other = race_B02001_009
) %>%
mutate(
pct_white = white / total * 100,
pct_black = black / total * 100,
pct_native_am = native_am / total * 100,
pct_asian = asian / total * 100,
pct_other = other / total * 100
) %>%
bind_rows(
summarise(.,
GEOID = "Total",
total = sum(total, na.rm = TRUE),
white = sum(white, na.rm = TRUE),
black = sum(black, na.rm = TRUE),
native_am = sum(native_am, na.rm = TRUE),
asian = sum(asian, na.rm = TRUE),
other = sum(other, na.rm = TRUE),
pct_white = white / total * 100,
pct_black = black / total * 100,
pct_native_am = native_am / total * 100,
pct_asian = asian / total * 100,
pct_other = other / total * 100)
)
#pull ethnicity  from ACS
ethnicity <-
get_acs(
geography = "tract",
table = "B03002",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE
)
View(ethnicity)
ethnicity_wide_pico <- ethnicity %>%
filter(GEOID %in% pico_tracts$GEOID,
variable %in% c("B03002_001",  # Total pop
"B03002_003",  # White
"B03002_004",  # Black
"B03002_005",  # American Indian
"B03002_006",  # Asian
"B03002_007",  # Hawaiian and Pacific Islander
"B03002_010",  # Other
"B03002_012"   # Hispanic
)) %>%
select(GEOID, variable, estimate) %>%
pivot_wider(
names_from = variable,
values_from = estimate,
names_prefix = "eth_"
) %>%
rename(
total = eth_B03002_001,
white = eth_B03002_003,
black = eth_B03002_004,
native_am = eth_B03002_005,
asian = eth_B03002_006,
hawaiian_pac = eth_B03002_007,
other = eth_B03002_010,
hispanic = eth_B03002_012
) %>%
mutate(
native_hawaiian = native_am + hawaiian_pac,
pct_white = white / total * 100,
pct_black = black / total * 100,
pct_native_hawaiian = native_hawaiian / total * 100,
pct_asian = asian / total * 100,
pct_other = other / total * 100,
pct_hispanic = hispanic / total * 100
) %>%
bind_rows(
summarise(.,
GEOID = "Total",
total = sum(total, na.rm = TRUE),
white = sum(white, na.rm = TRUE),
black = sum(black, na.rm = TRUE),
native_am = sum(native_am, na.rm = TRUE),
hawaiian_pac = sum(hawaiian_pac, na.rm = TRUE),
native_hawaiian = native_am + hawaiian_pac,
asian = sum(asian, na.rm = TRUE),
other = sum(other, na.rm = TRUE),
hispanic = sum(hispanic, na.rm = TRUE),
pct_white = white / total * 100,
pct_black = black / total * 100,
pct_native_hawaiian = native_hawaiian / total * 100,
pct_asian = asian / total * 100,
pct_other = other / total * 100,
pct_hispanic = hispanic / total * 100)
)
View(ethnicity_wide_pico)
#reformat for ggplot
ethnicity_long <- ethnicity_wide_pico %>%
filter(GEOID == "Total") %>%
select(starts_with("pct_")) %>%
pivot_longer(
cols = everything(),
names_to = "group",
values_to = "percent"
) %>%
mutate(
group = recode(group,
pct_white = "White",
pct_black = "Black",
pct_native_hawaiian = "Native/PI",
pct_asian = "Asian",
pct_other = "Other",
pct_hispanic = "Hispanic")
)
ethnicity_table <- ggplot(ethnicity_long, aes(x = reorder(group, -percent), y = percent, fill = group)) +
geom_bar(stat = "identity") +
labs(
title = "Ethnicity Composition in Pico Tracts",
x = "Group",
y = "Percent of Population"
) +
scale_y_continuous(labels = scales::percent_format(scale = 1))
ethnicity_table
#reformat for ggplot
ethnicity_long <- ethnicity_wide_pico %>%
filter(GEOID == "Total") %>%
select(starts_with("pct_")) %>%
pivot_longer(
cols = everything(),
names_to = "group",
values_to = "percent"
) %>%
mutate(
group = recode(group,
pct_white = "White",
pct_black = "Black",
pct_native_hawaiian = "Native American, Alaska Native, Native Hawaiiwan, and other Pacific Islander",
pct_asian = "Asian",
pct_other = "Other",
pct_hispanic = "Hispanic")
)
ethnicity_table <- ggplot(ethnicity_long, aes(x = reorder(group, -percent), y = percent, fill = group)) +
geom_bar(stat = "identity") +
labs(
title = NULL,
x = "Group",
y = "Percent of Population"
) +
scale_y_continuous(labels = scales::percent_format(scale = 1))+
theme(legend.position = "none")
ethnicity_table
#used for charts
library(stringr)
ethnicity_table <- ggplot(ethnicity_long, aes(x = reorder(group, -percent), y = percent, fill = group)) +
geom_bar(stat = "identity") +
labs(
title = NULL,
x = "Group",
y = "Percent of Population"
) +
scale_y_continuous(labels = scales::percent_format(scale = 1))+
scale_x_discrete(labels = function(x) str_wrap(x, width = 10)) +
theme(legend.position = "none")
ethnicity_table
ethnicity_table <- ggplot(ethnicity_long, aes(x = reorder(group, -percent), y = percent, fill = group)) +
geom_bar(stat = "identity") +
labs(
title = NULL,
x = "Group",
y = "Percent of Population"
) +
scale_y_continuous(labels = scales::percent_format(scale = 1))+
scale_x_discrete(labels = function(x) str_wrap(x, width = 12)) +
theme(legend.position = "none")
ethnicity_table
ethnicity_table <- ggplot(ethnicity_long, aes(x = reorder(group, -percent), y = percent, fill = group)) +
geom_bar(stat = "identity") +
labs(
title = NULL,
x = "Group",
y = "Percent of Population"
) +
scale_y_continuous(labels = scales::percent_format(scale = 1))+
scale_x_discrete(labels = function(x) str_wrap(x, width = 16)) +
theme(legend.position = "none")
ethnicity_table
ethnicity_table <- ggplot(ethnicity_long, aes(x = reorder(group, -percent), y = percent, fill = group)) +
geom_bar(stat = "identity") +
labs(
title = NULL,
x = NULL,
y = "Percent of Corridor"
) +
scale_y_continuous(labels = scales::percent_format(scale = 1))+
scale_x_discrete(labels = function(x) str_wrap(x, width = 16)) +
theme(legend.position = "none")
ethnicity_table
ethnicity_table_pico <- ggplot(ethnicity_long, aes(x = reorder(group, -percent), y = percent, fill = group)) +
geom_bar(stat = "identity") +
labs(
title = NULL,
x = NULL,
y = "Percent of Corridor"
) +
scale_y_continuous(labels = scales::percent_format(scale = 1))+
scale_x_discrete(labels = function(x) str_wrap(x, width = 16)) +
theme(legend.position = "none")
ggsave(file.path(file_path, "Pico/Outputs/ethnicity_table_pico.png"), width = 14, height = 6, dpi = 300)
ethnicity_chart_pico <- ggplot(ethnicity_long, aes(x = reorder(group, -percent), y = percent, fill = group)) +
geom_bar(stat = "identity") +
labs(
title = NULL,
x = NULL,
y = "Percent of Corridor"
) +
scale_y_continuous(labels = scales::percent_format(scale = 1))+
scale_x_discrete(labels = function(x) str_wrap(x, width = 16)) +
theme(legend.position = "none")
ggsave(file.path(file_path, "Pico/Outputs/ethnicity_chart_pico.png"), width = 14, height = 6, dpi = 300)
ethnicity_chart_pico <- ggplot(ethnicity_long, aes(x = reorder(group, -percent), y = percent, fill = group)) +
geom_bar(stat = "identity") +
labs(
title = NULL,
x = NULL,
y = "Percent of Corridor"
) +
scale_y_continuous(labels = scales::percent_format(scale = 1))+
scale_x_discrete(labels = function(x) str_wrap(x, width = 16)) +
theme(legend.position = "none")+
theme(
axis.title.x = element_text(size = 16),
axis.title.y = element_text(size = 16),
axis.text.x = element_text(size = 16),
axis.text.y = element_text(size = 16))
ethnicity_chart_pico
ggsave(file.path(file_path, "Pico/Outputs/ethnicity_chart_pico.png"), width = 14, height = 6, dpi = 300)
