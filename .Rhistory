Sys.getenv("CENSUS_API_KEY")
state_fips <- "06"
county_fips <- "037"
##Population##
#pull population table from ACS
sex_by_age <- get_acs(
geography = "tract",
table = "B01001",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE
)
#restructure so that each row is a census tract
##ADD geometry##
age_wide_pico <- sex_by_age %>%
select(GEOID, variable, estimate, moe) %>%
filter(variable == "B01001_001", GEOID %in% pico_tracts$GEOID)%>%
pivot_wider(names_from = variable, values_from = estimate)%>%
rename(population = B01001_001)
#add census tracts
age_wide_pico <- left_join(pico_tracts, age_wide_pico, by = "GEOID")
#create map of population
population_map_pico <- ggplot(age_wide_pico) +
geom_sf(aes(fill = population), show.legend = TRUE) +
#add the buffer overlay
geom_sf(data = pico_buffer_tracts, color = "black", alpha = 0.2, lwd = 1) +
geom_sf(data = major_streets, color = "gray20", size = 0.3) +
scale_fill_gradientn(
colors = palette_urbn_cyan[c(2, 4, 6, 7)],  # Selecting a subset of colors
name = "Population by Census Tract",
labels = scales::comma
) +
theme_urbn_map()
population_map_pico
#create map of population
population_map_pico <- ggplot(age_wide_pico) +
geom_sf(aes(fill = population), show.legend = TRUE) +
#add the streets overlay
geom_sf(data = major_streets, color = "gray20", size = 0.3) +
scale_fill_gradientn(
colors = palette_urbn_cyan[c(2, 4, 6, 7)],  # Selecting a subset of colors
name = "Population by Census Tract",
labels = scales::comma
) +
theme_urbn_map()
population_map_pico
ggsave(file.path(file_path, "Pico/Outputs/population_map_pico.png"), width = 14, height = 6, dpi = 300)
#create map of population
population_map_pico <- ggplot(age_wide_pico) +
geom_sf(aes(fill = population), show.legend = TRUE) +
#add the buffer overlay
geom_sf(data = pico_buffer_tracts, color = "black", alpha = 0.2, lwd = 1) +
#add the street overlay
geom_sf(data = major_streets, color = "gray20", size = 0.3) +
scale_fill_gradientn(
colors = palette_urbn_cyan[c(2, 4, 6, 7)],  # Selecting a subset of colors
name = "Population by Census Tract",
labels = scales::comma
) +
theme_urbn_map()
population_map_pico <- ggplot(age_wide_pico) +
geom_sf(aes(fill = population), show.legend = TRUE) +
#add the buffer overlay
geom_sf(data = pico_buffer_tracts, color = "black", alpha = 0.2, lwd = 1) +
#add the street overlay
geom_sf(data = major_streets, color = "gray20", size = 0.3) +
scale_fill_gradientn(
colors = palette_urbn_cyan[c(2, 4, 6, 7)],  # Selecting a subset of colors
name = "Population by Census Tract",
labels = scales::comma
) +
theme_urbn_map()
population_map_pico
#create map of population
population_map_pico <- ggplot(age_wide_pico) +
geom_sf(aes(fill = population), show.legend = TRUE) +
#add the buffer overlay
geom_sf(data = pico_buffer_tracts, color = "gray", alpha = 0.2, lwd = 1) +
#add the street overlay
geom_sf(data = major_streets, color = "gray20", size = 0.3) +
scale_fill_gradientn(
colors = palette_urbn_cyan[c(2, 4, 6, 7)],  # Selecting a subset of colors
name = "Population by Census Tract",
labels = scales::comma
) +
theme_urbn_map()
population_map_pico
major_streets_clipped <- st_intersection(major_streets, st_union(st_geometry(age_wide_pico)))
major_streets_clipped <- st_intersection(major_streets, st_union(st_geometry(pico_tracts)))
#filter to main streets
major_streets <- streets_lines[streets_lines$highway %in% c("primary", "secondary", "tertiary"), ]%>%
st_transform(major_streets, st_crs(pico_tracts))
#filter to main streets
major_streets <- streets_lines[streets_lines$highway %in% c("primary", "secondary", "tertiary"), ]%>%
st_transform(st_crs(pico_tracts))
#filter to main streets
major_streets <- streets_lines %>%
filter(highway %in% c("primary", "secondary", "tertiary")) %>%
st_transform(st_crs(pico_tracts))
major_streets_clipped <- st_intersection(major_streets, st_union(st_geometry(pico_tracts)))
#create map of population
population_map_pico <- ggplot(age_wide_pico) +
geom_sf(aes(fill = population), show.legend = TRUE) +
#add the buffer overlay
geom_sf(data = pico_buffer_tracts, color = "gray", alpha = 0.2, lwd = 1) +
#add the street overlay
geom_sf(data = major_streets_clipped, color = "gray20", size = 0.3) +
scale_fill_gradientn(
colors = palette_urbn_cyan[c(2, 4, 6, 7)],  # Selecting a subset of colors
name = "Population by Census Tract",
labels = scales::comma
) +
theme_urbn_map()
population_map_pico
#create map of population
population_map_pico <- ggplot(age_wide_pico) +
geom_sf(aes(fill = population), show.legend = TRUE) +
#add the buffer overlay
geom_sf(data = pico_buffer_tracts, color = "gray", alpha = 0.2, lwd = 1) +
#add the street overlay
geom_sf(data = major_streets, color = "gray20", size = 0.3) +
scale_fill_gradientn(
colors = palette_urbn_cyan[c(2, 4, 6, 7)],  # Selecting a subset of colors
name = "Population by Census Tract",
labels = scales::comma
) +
theme_urbn_map()
population_map_pico
View(v23)
View(v23)
View(v23)
##Age##
#see sex_by_age
view(v23)
#restructure so that each row is a census tract
##ADD geometry##
age_wide_pico <- sex_by_age %>%
select(GEOID, variable, estimate, moe) %>%
filter(variable == "B01001_001", GEOID %in% pico_tracts$GEOID)%>%
pivot_wider(names_from = variable, values_from = estimate)%>%
rename(population = B01001_001)
#restructure so that each row is a census tract
##ADD geometry##
pop_wide_pico <- sex_by_age %>%
select(GEOID, variable, estimate, moe) %>%
filter(variable == "B01001_001", GEOID %in% pico_tracts$GEOID)%>%
pivot_wider(names_from = variable, values_from = estimate)%>%
rename(population = B01001_001)
#add census tracts
pop_wide_pico <- left_join(pico_tracts, pop_wide_pico, by = "GEOID")
##Age##
#see sex_by_age
age_bins <- list(
age_0_17  = c("B01001_003", "B01001_004", "B01001_005", "B01001_006",
"B01001_027", "B01001_028", "B01001_029", "B01001_030"),
age_18_34 = c("B01001_007", "B01001_008", "B01001_009", "B01001_010", "B01001_011", "B01001_012",
"B01001_031", "B01001_032", "B01001_033","B01001_034", "B01001_035", "B01001_036"),
age_35_64 = c("B01001_013", "B01001_014", "B01001_015", "B01001_016", "B01001_017", "B01001_018", "B01001_019",
"B01001_037", "B01001_038", "B01001_039", "B01001_040", "B01001_041", "B01001_042", "B01001_043"),
age_65_up = c("B01001_020", "B01001_021", "B01001_022", "B01001_023", "B01001_024", "B01001_025",
"B01001_044", "B01001_041", "B01001_042", "B01001_043", "B01001_044", "B01001_045")
)
#create map of population
population_map_pico <- ggplot(pop_wide_pico) +
geom_sf(aes(fill = population), show.legend = TRUE) +
#add the buffer overlay
geom_sf(data = pico_buffer_tracts, color = "gray", alpha = 0.2, lwd = 1) +
#add the street overlay
geom_sf(data = major_streets_clipped, color = "gray20", size = 0.3) +
scale_fill_gradientn(
colors = palette_urbn_cyan[c(2, 4, 6, 7)],  # Selecting a subset of colors
name = "Population by Census Tract",
labels = scales::comma
) +
theme_urbn_map()
population_map_pico
ggsave(file.path(file_path, "Pico/Outputs/population_map_pico.png"), width = 14, height = 6, dpi = 300)
#create map of population
population_map_pico <- ggplot(pop_wide_pico) +
geom_sf(aes(fill = population), show.legend = TRUE) +
#add the buffer overlay
geom_sf(data = pico_buffer_tracts, color = "gray", alpha = 0.2, lwd = 1) +
#add the street overlay
geom_sf(data = major_streets_clipped, color = "gray20", size = 0.3) +
scale_fill_gradientn(
colors = palette_urbn_cyan[c(2, 4, 6, 7)],  # Selecting a subset of colors
name = "Population by Census Tract",
labels = scales::comma
) +
theme_urbn_map()+
theme(
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
population_map_pico
ggsave(file.path(file_path, "Pico/Outputs/population_map_pico.png"), width = 14, height = 6, dpi = 300)
#create map of population
population_map_pico <- ggplot(pop_wide_pico) +
geom_sf(aes(fill = population), show.legend = TRUE) +
#add the buffer overlay
geom_sf(data = pico_buffer_tracts, color = "gray", alpha = 0.2, lwd = 1) +
#add the street overlay
geom_sf(data = major_streets_clipped, color = "gray20", size = 0.3) +
scale_fill_gradientn(
colors = palette_urbn_cyan[c(2, 4, 6, 7)],  # Selecting a subset of colors
name = "Population by Census Tract",
labels = scales::comma
) +
theme_urbn_map()+
theme(
legend.title = element_text(size = 16),
legend.text = element_text(size = 16)
)
ggsave(file.path(file_path, "Pico/Outputs/population_map_pico.png"), width = 14, height = 6, dpi = 300)
#create map of population
population_map_pico <- ggplot(pop_wide_pico) +
geom_sf(aes(fill = population), show.legend = TRUE) +
#add the buffer overlay
geom_sf(data = pico_buffer_tracts, color = "gray", alpha = 0.2, lwd = 1) +
#add the street overlay
geom_sf(data = major_streets_clipped, color = "gray20", size = 0.3) +
scale_fill_gradientn(
colors = palette_urbn_cyan[c(2, 4, 6, 7)],  # Selecting a subset of colors
name = "Population by Census Tract",
labels = scales::comma
) +
theme_urbn_map()+
theme(
legend.title = element_text(size = 16),
legend.text = element_text(size = 16),
legend.key.height = unit(1.2, "cm"),
legend.key.width = unit(0.6, "cm")
)
population_map_pico
ggsave(file.path(file_path, "Pico/Outputs/population_map_pico.png"), width = 14, height = 6, dpi = 300)
age_wide_pico <- sex_by_age %>%
filter(variable %in% unlist(age_bins), GEOD %in% pico_tracts$GEOID)%>%
group_by(GEOID)%>%
mutate(age_group = case_when(
variable %in% age_bins$age_0_17 ~ "age_0_18",
variable %in% age_bins$age_18_34 ~ "age_19_34",
variable %in% age_bins$age_35_64 ~ "age_35_64",
variable %in% age_bins$age_65_up ~ "age_65_up"
)) %>%
group_by(GEOID, age_group)%>%
summarise(population = sum(estimate, na.rm = TRUE), .groups = "drop")%>%
pivot_wider(names_from = age_group, values_from = population)
age_wide_pico <- sex_by_age %>%
filter(variable %in% unlist(age_bins), GEOID %in% pico_tracts$GEOID)%>%
group_by(GEOID)%>%
mutate(age_group = case_when(
variable %in% age_bins$age_0_17 ~ "age_0_18",
variable %in% age_bins$age_18_34 ~ "age_19_34",
variable %in% age_bins$age_35_64 ~ "age_35_64",
variable %in% age_bins$age_65_up ~ "age_65_up"
)) %>%
group_by(GEOID, age_group)%>%
summarise(population = sum(estimate, na.rm = TRUE), .groups = "drop")%>%
pivot_wider(names_from = age_group, values_from = population)
#calculate the total age
age_totals <- age_wide_pico %>%
summarise(across(starts_with("age_"), ~sum(.x, na.rm = TRUE))) %>%
pivot_longer(
cols = everything(),
names_to = "age_group",
values_to = "population"
)
View(age_totals)
#summarise total by age, for each tract
age_wide_pico <- sex_by_age %>%
filter(variable %in% unlist(age_bins), GEOID %in% pico_tracts$GEOID)%>%
group_by(GEOID)%>%
mutate(age_group = case_when(
variable %in% age_bins$age_0_17 ~ "age_0_18",
variable %in% age_bins$age_18_34 ~ "age_19_34",
variable %in% age_bins$age_35_64 ~ "age_35_64",
variable %in% age_bins$age_65_up ~ "age_65_up"
)) %>%
group_by(GEOID, age_group)%>%
summarise(population = sum(estimate, na.rm = TRUE), .groups = "drop")%>%
pivot_wider(names_from = age_group, values_from = population)%>%
bind_rows(
summarise(across(.cols = where(is.numeric), sum, na.rm = TRUE)) %>%
mutate(GEOID = "Total") %>%
select(GEOID, everything())
)
ggplot(age_totals, aes(x = age_group, y = population, fill = age_group)) +
geom_col() +
labs(
x = "Age Group",
y = "Population"
) +
scale_y_continuous(labels = scales::comma) +
theme(legend.position = "none")
pop_by_age_group <- ggplot(age_totals, aes(x = age_group, y = population, fill = age_group)) +
geom_col() +
labs(
x = "Age Group",
y = "Population"
) +
scale_x_discrete(
labels = c(
"age_0_18" = "0-18",
"age_19_34" = "19-34",
"age_35_64" = "35-64",
"age_65_up" = "65+"
))+
scale_y_continuous(labels = scales::comma) +
theme(legend.position = "none")
pop_by_age_group
#create a bar chart
pop_by_age_group <- ggplot(age_totals, aes(x = age_group, y = population, fill = age_group)) +
geom_col() +
labs(
x = "Age Group",
y = "Population"
) +
scale_x_discrete(
labels = c(
"age_0_18" = "0-18",
"age_19_34" = "19-34",
"age_35_64" = "35-64",
"age_65_up" = "65+"
))+
scale_y_continuous(labels = scales::comma) +
theme(legend.position = "none")
ggsave(file.path(file_path, "Pico/Outputs/age_chart_pico.png"), width = 14, height = 6, dpi = 300)
#create a bar chart
pop_by_age_group <- ggplot(age_totals, aes(x = age_group, y = population, fill = age_group)) +
geom_col() +
labs(
x = "Age Group",
y = "Population"
) +
scale_x_discrete(
labels = c(
"age_0_18" = "0-18",
"age_19_34" = "19-34",
"age_35_64" = "35-64",
"age_65_up" = "65+"
))+
scale_y_continuous(labels = scales::comma) +
theme(legend.position = "none")+
axis.title.x = element_text(size = 16),  # Increase x-axis title size
#create a bar chart
pop_by_age_group <- ggplot(age_totals, aes(x = age_group, y = population, fill = age_group)) +
geom_col() +
labs(
x = "Age Group",
y = "Population"
) +
scale_x_discrete(
labels = c(
"age_0_18" = "0-18",
"age_19_34" = "19-34",
"age_35_64" = "35-64",
"age_65_up" = "65+"
))+
scale_y_continuous(labels = scales::comma) +
theme(legend.position = "none")+
axis.title.x = element_text(size = 16),  # Increase x-axis title size
#create a bar chart
pop_by_age_group <- ggplot(age_totals, aes(x = age_group, y = population, fill = age_group)) +
geom_col() +
labs(
x = "Age Group",
y = "Population"
) +
scale_x_discrete(
labels = c(
"age_0_18" = "0-18",
"age_19_34" = "19-34",
"age_35_64" = "35-64",
"age_65_up" = "65+"
))+
scale_y_continuous(labels = scales::comma) +
theme(legend.position = "none")+
theme(
axis.title.x = element_text(size = 16),
axis.title.y = element_text(size = 16))   # Increase y-axis title size
pop_by_age_group
#create a bar chart
pop_by_age_group <- ggplot(age_totals, aes(x = age_group, y = population, fill = age_group)) +
geom_col() +
labs(
x = "Age Group",
y = "Population"
) +
scale_x_discrete(
labels = c(
"age_0_18" = "0-18",
"age_19_34" = "19-34",
"age_35_64" = "35-64",
"age_65_up" = "65+"
))+
scale_y_continuous(labels = scales::comma) +
theme(legend.position = "none")+
theme(
axis.title.x = element_text(size = 14),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 16),
axis.text.y = element_text(size = 16))
pop_by_age_group
#create a bar chart
pop_by_age_group <- ggplot(age_totals, aes(x = age_group, y = population, fill = age_group)) +
geom_col() +
labs(
x = "Age Group",
y = "Population"
) +
scale_x_discrete(
labels = c(
"age_0_18" = "0-18",
"age_19_34" = "19-34",
"age_35_64" = "35-64",
"age_65_up" = "65+"
))+
scale_y_continuous(labels = scales::comma) +
theme(legend.position = "none")+
theme(
axis.title.x = element_text(size = 14),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 16),
axis.text.y = element_text(size = 16))
ggsave(file.path(file_path, "Pico/Outputs/age_chart_pico.png"), width = 14, height = 6, dpi = 300)
##Disability Status##
#pull disability status
disability <-
get_acs(
geography = "tract",
table = "B18101",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = TRUE,
)
disability
##Disability Status##
#pull disability status
disability <-
get_acs(
geography = "tract",
table = "B18101",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE,
)
View(v23)
View(disability)
#pull computer access data
tech_access <-
get_acs(
geography = "tract",
table = "B28001",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE,
)
View(tech_access)
data_sv_path <- file.path (file_path, "Files", "filename.csv")
write.csv(sex_by_age, file = data_sv_path, row.names = FALSE)
data_sv_path <- file.path (file_path, "Files")
write.csv(sex_by_age, file = data_sv_path, row.names = FALSE)
data_sv_path <- file.path (file_path, "Pico/Files")
write.csv(sex_by_age, file = data_sv_path, row.names = FALSE)
write.csv(pop_wide_pico, file.path(file_path, "Pico", "Files", "pop_wide_pico.csv"), row.names = FALSE)
write.csv(sex_by_age, file.path(file_path, "Fileshare", "sex_by_age.csv"), row.names = FALSE)
write.csv(sex_by_age, file.path(file_path, "Fileshare", "sex_by_age.csv"), row.names = FALSE)
write.csv(sex_by_age, file.path(file_path, "Fileshare", "sex_by_age.csv"), row.names = FALSE)
write.csv(sex_by_age, file.path(file_path, "Fileshare", "sex_by_age.csv"), row.names = FALSE)
write.csv(sex_by_age, file.path(file_path, "Fileshare", "sex_by_age.csv"), row.names = FALSE)
write.csv(race, file.path(file_path, "Fileshare", "race.csv"), row.names = FALSE)
##Race and Ethnicity##
#pull race  from ACS
race <- get_acs(
geography = "tract",
table = "B02001",
state = state_fips,
county = county_fips,
year = 2023,
survey = "acs5",
geometry = FALSE
)
write.csv(race, file.path(file_path, "Fileshare", "race.csv"), row.names = FALSE)
#create map of population
population_map_pico <- ggplot(pop_wide_pico) +
geom_sf(aes(fill = population), show.legend = TRUE) +
#add the buffer overlay
geom_sf(data = pico_buffer_tracts, color = "yellow", alpha = 0.2, lwd = 1) +
#add the street overlay
geom_sf(data = major_streets_clipped, color = "gray20", size = 0.3) +
scale_fill_gradientn(
colors = palette_urbn_cyan[c(2, 4, 6, 7)],  # Selecting a subset of colors
name = "Population by Census Tract",
labels = scales::comma
) +
theme_urbn_map()+
theme(
legend.title = element_text(size = 16),
legend.text = element_text(size = 16),
legend.key.height = unit(1.2, "cm"),
legend.key.width = unit(0.6, "cm")
)
population_map_pico
ggsave(file.path(file_path, "Pico/Outputs/population_map_pico.png"), width = 14, height = 6, dpi = 300)
